import{r as l,a as J,R as W}from"./vendor-cxkclgJA.js";import{c as Y,a as f,f as I,u as X}from"./xstate-D_sjYDNq.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();var F={exports:{}},N={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q=l,Z=Symbol.for("react.element"),ee=Symbol.for("react.fragment"),te=Object.prototype.hasOwnProperty,se=Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,re={key:!0,ref:!0,__self:!0,__source:!0};function B(r,e,t){var s,n={},a=null,i=null;t!==void 0&&(a=""+t),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(i=e.ref);for(s in e)te.call(e,s)&&!re.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:Z,type:r,key:a,ref:i,props:n,_owner:se.current}}N.Fragment=ee;N.jsx=B;N.jsxs=B;F.exports=N;var o=F.exports,O={},D=J;O.createRoot=D.createRoot,O.hydrateRoot=D.hydrateRoot;const ae="modulepreload",ne=function(r){return"/"+r},z={},A=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),u=i?.nonce||i?.getAttribute("nonce");n=Promise.allSettled(t.map(c=>{if(c=ne(c),c in z)return;z[c]=!0;const m=c.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":ae,m||(p.as="script"),p.crossOrigin="",p.href=c,u&&p.setAttribute("nonce",u),document.head.appendChild(p),m)return new Promise((h,d)=>{p.addEventListener("load",h),p.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(i){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=i,window.dispatchEvent(u),!u.defaultPrevented)throw i}return n.then(i=>{for(const u of i||[])u.status==="rejected"&&a(u.reason);return e().catch(a)})},ie={sttProvider:"whisper",allowCloudNLP:!0,ttsProvider:"system"},oe=Y({id:"orchestrator",initial:"idle",context:{input:"",result:"",isRecording:!1,settings:ie,intent:null,error:null,isVisible:!1,inputMode:"text",executionResult:null},states:{idle:{entry:f({input:"",result:"",intent:null,error:null,isRecording:!1}),on:{HOTKEY_TOGGLE:{actions:f({isVisible:({context:r})=>!r.isVisible})},TEXT_SUBMIT:{target:"parseIntent",guard:"isTextMode",actions:f({input:({event:r})=>r.text,inputMode:"text"})},START_CAPTURE:{target:"capture",guard:"isVoiceMode",actions:f({inputMode:"voice"})},UPDATE_SETTINGS:{actions:f({settings:({event:r})=>r.settings})}}},capture:{entry:[f({isRecording:!0}),"startRecording"],exit:[f({isRecording:!1}),"stopRecording"],on:{STT_RESULT:{target:"parseIntent",actions:f({input:({event:r})=>r.text})},CANCEL:"idle",HOTKEY_TOGGLE:"idle"}},parseIntent:{invoke:{src:"parseIntent",input:({context:r})=>({text:r.input,settings:r.settings}),onDone:{target:"route",actions:f({intent:({event:r})=>r.output})},onError:{target:"recover",actions:[f({error:({event:r})=>r.error?.message||"Failed to parse intent"}),"showError"]}}},route:{always:[{target:"execute",guard:({context:r})=>r.intent?.action!=="unknown"},{target:"recover",actions:[f({error:"Could not understand the command"}),"showError"]}]},execute:{invoke:{src:"executeCommand",input:({context:r})=>({intent:r.intent,settings:r.settings}),onDone:[{target:"verify",guard:({event:r})=>r.output.requiresVerification,actions:f({executionResult:({event:r})=>r.output})},{target:"respond",actions:f({executionResult:({event:r})=>r.output,result:({event:r})=>r.output.message})}],onError:{target:"recover",actions:[f({error:({event:r})=>r.error?.message||"Execution failed"}),"showError"]}},on:{EXEC_ERR:{target:"recover",actions:[f({error:({event:r})=>r.message}),"showError"]}}},verify:{entry:"requestVerification",on:{VERIFY_OK:{target:"respond",actions:f({result:({context:r})=>r.executionResult?.message||"Operation completed"})},VERIFY_ERR:{target:"recover",actions:[f({error:"Operation cancelled by user"}),"showError"]},CANCEL:"idle"}},respond:{entry:[f({result:({context:r})=>r.executionResult?.message||r.result}),"speak"],invoke:{src:"generateResponse",input:({context:r})=>({result:r.result,settings:r.settings}),onDone:{target:"idle",actions:f({result:({event:r})=>r.output})},onError:"idle"},after:{5e3:"idle"},on:{HOTKEY_TOGGLE:"idle",CANCEL:"idle"}},recover:{entry:"speak",after:{3e3:"idle"},on:{HOTKEY_TOGGLE:"idle",CANCEL:"idle",TEXT_SUBMIT:{target:"parseIntent",guard:"isTextMode",actions:f({input:({event:r})=>r.text,error:null})}}}}},{guards:{isTextMode:({context:r})=>r.inputMode==="text",isVoiceMode:({context:r})=>r.inputMode==="voice"||r.settings.sttProvider!=="none",cloudAllowed:({context:r})=>r.settings.allowCloudNLP},actions:{speak:({context:r})=>{const e=r.error||r.result;e&&r.settings.ttsProvider!=="none"&&console.log("Speaking:",e)},showError:({context:r})=>{console.error("Assistant Error:",r.error)},startRecording:()=>{console.log("Starting voice recording...")},stopRecording:()=>{console.log("Stopping voice recording...")},requestVerification:({context:r})=>{console.log("Requesting verification for:",r.executionResult)}},actors:{parseIntent:I(async({input:r})=>{const{text:e,settings:t}=r;if(t.allowCloudNLP){try{const{kiroAgent:a}=await A(async()=>{const{kiroAgent:u}=await Promise.resolve().then(()=>K);return{kiroAgent:u}},void 0),i=a.analyzeInput(e);if(i.confidence>.7){const u=a.extractParameters(i.tool,e);return{action:i.tool,parameters:u,confidence:i.confidence}}}catch(a){console.warn("Kiro agent parsing failed, falling back to GPT-4o:",a)}const{parseIntent:s}=await A(async()=>{const{parseIntent:a}=await import("./intentParser-XiCIU7kS.js");return{parseIntent:a}},[]),n=await s(e);if("error"in n)throw new Error(`Intent parsing failed: ${n.error.message}`);return{action:n.intent.toLowerCase(),parameters:n.parameters,confidence:n.confidence}}else try{const{kiroAgent:s}=await A(async()=>{const{kiroAgent:i}=await Promise.resolve().then(()=>K);return{kiroAgent:i}},void 0),n=s.analyzeInput(e),a=s.extractParameters(n.tool,e);return{action:n.tool,parameters:a,confidence:n.confidence}}catch(s){console.warn("Kiro agent local parsing failed:",s),await new Promise(a=>setTimeout(a,500));const n=e.toLowerCase();return n.includes("create")&&n.includes("file")?{action:"create_file",parameters:{title:e.match(/create.*?file.*?(?:called|named)?\s*([^\s]+)/i)?.[1]||"untitled.txt",content:""},confidence:.8}:n.includes("open")?{action:"open_item",parameters:{query:e.replace(/open\s+/i,""),type:"auto"},confidence:.75}:n.includes("sum")||n.includes("analyze")?{action:"analyze_sheet",parameters:{path:"data.csv",op:"sum",column:"value"},confidence:.7}:{action:"create_file",parameters:{title:"untitled.txt",content:e},confidence:.6}}}),executeCommand:I(async({input:r})=>{const{intent:e,settings:t}=r,{executeIntent:s}=await A(async()=>{const{executeIntent:i}=await Promise.resolve().then(()=>Ie);return{executeIntent:i}},void 0),n={intent:e?.action||"CreateFile",confidence:e.confidence,parameters:e.parameters,context:{sessionId:"default",timestamp:new Date().toISOString(),userInput:"command execution"}},a=await s(n,i=>{console.log("Execution progress:",i)});return{success:a.success,message:a.message,requiresVerification:a.requiresVerification||!1,data:a.data}}),generateResponse:I(async({input:r})=>(await new Promise(e=>setTimeout(e,800)),r.result))}});class ce{name="whisper-api";mediaRecorder=null;audioChunks=[];resultCallback=null;errorCallback=null;apiKey;isRecording=!1;constructor(e){this.apiKey=e}async isAvailable(){try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(t=>t.stop()),!!this.apiKey}catch{return!1}}async startRecording(){if(!this.isRecording)try{const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});this.mediaRecorder=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"}),this.audioChunks=[],this.isRecording=!0,this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.audioChunks.push(t.data)},this.mediaRecorder.onstop=async()=>{await this.processAudio(),this.cleanup()},this.mediaRecorder.onerror=t=>{this.errorCallback?.(new Error(`Recording error: ${t.error}`))},this.mediaRecorder.start(1e3),this.startPartialProcessing()}catch(e){this.errorCallback?.(e)}}async stopRecording(){!this.isRecording||!this.mediaRecorder||(this.isRecording=!1,this.mediaRecorder.stop(),this.mediaRecorder.stream?.getTracks().forEach(e=>e.stop()))}startPartialProcessing(){const e=setInterval(async()=>{if(!this.isRecording){clearInterval(e);return}if(this.audioChunks.length>0){const t=new Blob(this.audioChunks.slice(-3),{type:"audio/webm"});await this.sendToWhisper(t,!1)}},3e3)}async processAudio(){if(this.audioChunks.length===0)return;const e=new Blob(this.audioChunks,{type:"audio/webm"});await this.sendToWhisper(e,!0)}async sendToWhisper(e,t){try{const s=new FormData;s.append("file",e,"audio.webm"),s.append("model","whisper-1"),s.append("language","en"),s.append("response_format","json");const n=await fetch("https://api.openai.com/v1/audio/transcriptions",{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`},body:s});if(!n.ok)throw new Error(`Whisper API error: ${n.status} ${n.statusText}`);const a=await n.json();a.text&&a.text.trim()&&this.resultCallback?.({text:a.text.trim(),isFinal:t,confidence:.9,timestamp:Date.now()})}catch(s){this.errorCallback?.(s)}}onResult(e){this.resultCallback=e}onError(e){this.errorCallback=e}cleanup(){this.isRecording=!1,this.mediaRecorder=null,this.audioChunks=[],this.resultCallback=null,this.errorCallback=null}}class le{name="vosk-local";audioContext=null;processor=null;resultCallback=null;errorCallback=null;isRecording=!1;partialText="";constructor(){console.log("Initializing Vosk Local STT...")}async isAvailable(){try{return(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(t=>t.stop()),!0}catch{return!1}}async startRecording(){if(!this.isRecording)try{const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}});this.audioContext=new AudioContext({sampleRate:16e3});const t=this.audioContext.createMediaStreamSource(e);this.processor=this.audioContext.createScriptProcessor(4096,1,1),this.processor.onaudioprocess=s=>{if(!this.isRecording)return;const a=s.inputBuffer.getChannelData(0),i=this.convertToPCM16(a);this.processAudioChunk(i)},t.connect(this.processor),this.processor.connect(this.audioContext.destination),this.isRecording=!0,this.partialText="",this.startPartialResults()}catch(e){this.errorCallback?.(e)}}async stopRecording(){this.isRecording&&(this.isRecording=!1,this.partialText.trim()&&this.resultCallback?.({text:this.partialText.trim(),isFinal:!0,confidence:.85,timestamp:Date.now()}),this.cleanup())}convertToPCM16(e){const t=new Int16Array(e.length);for(let s=0;s<e.length;s++){const n=Math.max(-1,Math.min(1,e[s]||0));t[s]=n<0?n*32768:n*32767}return t}processAudioChunk(e){console.log(`Processing ${e.length} audio samples...`)}startPartialResults(){const e=setInterval(()=>{if(!this.isRecording){clearInterval(e);return}const t=["hello","hello world","hello world how","hello world how are","hello world how are you"],s=t[Math.floor(Math.random()*t.length)];s!==this.partialText&&(this.partialText=s||"",this.resultCallback?.({text:s||"",isFinal:!1,confidence:.7,timestamp:Date.now()}))},500)}onResult(e){this.resultCallback=e}onError(e){this.errorCallback=e}cleanup(){this.isRecording=!1,this.processor&&(this.processor.disconnect(),this.processor=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.resultCallback=null,this.errorCallback=null,this.partialText=""}}class ue{name="openai-tts";apiKey;currentAudio=null;isPlaying=!1;isPaused=!1;startCallback=null;endCallback=null;errorCallback=null;constructor(e){this.apiKey=e}async isAvailable(){return!!this.apiKey&&typeof Audio<"u"}async speak(e,t){this.isPlaying&&this.stop();try{const s=await this.generateAudio(e,t);await this.playAudio(s)}catch(s){throw this.errorCallback?.(s),s}}async generateAudio(e,t){const s=await fetch("https://api.openai.com/v1/audio/speech",{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:"tts-1",input:e,voice:t?.voice||"alloy",response_format:"mp3",speed:t?.rate||1})});if(!s.ok)throw new Error(`OpenAI TTS API error: ${s.status} ${s.statusText}`);const n=await s.blob();return URL.createObjectURL(n)}async playAudio(e){return new Promise((t,s)=>{this.currentAudio=new Audio(e),this.isPlaying=!0,this.isPaused=!1,this.currentAudio.onloadstart=()=>{this.startCallback?.()},this.currentAudio.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this.endCallback?.(),URL.revokeObjectURL(e),t()},this.currentAudio.onerror=n=>{this.isPlaying=!1,this.isPaused=!1,URL.revokeObjectURL(e);const a=new Error(`Audio playback error: ${n}`);this.errorCallback?.(a),s(a)},this.currentAudio.play().catch(s)})}stop(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.currentAudio=null),this.isPlaying=!1,this.isPaused=!1}pause(){this.currentAudio&&this.isPlaying&&!this.isPaused&&(this.currentAudio.pause(),this.isPaused=!0)}resume(){this.currentAudio&&this.isPaused&&(this.currentAudio.play(),this.isPaused=!1)}async getVoices(){return[{id:"alloy",name:"Alloy",lang:"en-US",gender:"neutral"},{id:"echo",name:"Echo",lang:"en-US",gender:"male"},{id:"fable",name:"Fable",lang:"en-US",gender:"neutral"},{id:"onyx",name:"Onyx",lang:"en-US",gender:"male"},{id:"nova",name:"Nova",lang:"en-US",gender:"female"},{id:"shimmer",name:"Shimmer",lang:"en-US",gender:"female"}]}onStart(e){this.startCallback=e}onEnd(e){this.endCallback=e}onError(e){this.errorCallback=e}}class de{name="edge-tts";currentAudio=null;isPlaying=!1;isPaused=!1;startCallback=null;endCallback=null;errorCallback=null;async isAvailable(){return typeof Audio<"u"&&"speechSynthesis"in window}async speak(e,t){this.isPlaying&&this.stop();try{const s=await this.generateAudio(e,t);await this.playAudio(s)}catch(s){throw this.errorCallback?.(s),s}}async generateAudio(e,t){const s=t?.voice||"en-US-AriaNeural",n=t?.rate?`${Math.round((t.rate-1)*100)}%`:"0%",a=t?.pitch?`${Math.round((t.pitch-1)*50)}Hz`:"0Hz",i=`
      <speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="en-US">
        <voice name="${s}">
          <prosody rate="${n}" pitch="${a}">
            ${this.escapeXml(e)}
          </prosody>
        </voice>
      </speak>
    `;try{const c=await(await this.callEdgeTTSService(i)).blob();return URL.createObjectURL(c)}catch{return this.fallbackToWebSpeech(e,t)}}async callEdgeTTSService(e){const t=new ArrayBuffer(1024),s=new Blob([t],{type:"audio/mp3"});return new Response(s,{status:200,headers:{"Content-Type":"audio/mp3"}})}async fallbackToWebSpeech(e,t){return new Promise((s,n)=>{if(!("speechSynthesis"in window)){n(new Error("Speech synthesis not supported"));return}const a=new SpeechSynthesisUtterance(e);if(t?.voice){const u=speechSynthesis.getVoices().find(c=>c.name.includes(t.voice)||c.lang.includes("en"));u&&(a.voice=u)}t?.rate&&(a.rate=t.rate),t?.pitch&&(a.pitch=t.pitch),t?.volume&&(a.volume=t.volume),a.onstart=()=>s("web-speech-fallback"),a.onerror=i=>n(new Error(`Speech synthesis error: ${i.error}`)),speechSynthesis.speak(a)})}async playAudio(e){if(e!=="web-speech-fallback")return new Promise((t,s)=>{this.currentAudio=new Audio(e),this.isPlaying=!0,this.isPaused=!1,this.currentAudio.onloadstart=()=>{this.startCallback?.()},this.currentAudio.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this.endCallback?.(),URL.revokeObjectURL(e),t()},this.currentAudio.onerror=n=>{this.isPlaying=!1,this.isPaused=!1,URL.revokeObjectURL(e);const a=new Error(`Audio playback error: ${n}`);this.errorCallback?.(a),s(a)},this.currentAudio.play().catch(s)})}stop(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.currentAudio=null),"speechSynthesis"in window&&speechSynthesis.cancel(),this.isPlaying=!1,this.isPaused=!1}pause(){this.currentAudio&&this.isPlaying&&!this.isPaused&&(this.currentAudio.pause(),this.isPaused=!0),"speechSynthesis"in window&&speechSynthesis.speaking&&(speechSynthesis.pause(),this.isPaused=!0)}resume(){this.currentAudio&&this.isPaused&&(this.currentAudio.play(),this.isPaused=!1),"speechSynthesis"in window&&speechSynthesis.paused&&(speechSynthesis.resume(),this.isPaused=!1)}async getVoices(){return[{id:"en-US-AriaNeural",name:"Aria (Neural)",lang:"en-US",gender:"female"},{id:"en-US-JennyNeural",name:"Jenny (Neural)",lang:"en-US",gender:"female"},{id:"en-US-GuyNeural",name:"Guy (Neural)",lang:"en-US",gender:"male"},{id:"en-US-DavisNeural",name:"Davis (Neural)",lang:"en-US",gender:"male"},{id:"en-GB-SoniaNeural",name:"Sonia (Neural)",lang:"en-GB",gender:"female"},{id:"en-GB-RyanNeural",name:"Ryan (Neural)",lang:"en-GB",gender:"male"}]}onStart(e){this.startCallback=e}onEnd(e){this.endCallback=e}onError(e){this.errorCallback=e}escapeXml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}}class pe{name="system-tts";currentUtterance=null;isPlaying=!1;isPaused=!1;startCallback=null;endCallback=null;errorCallback=null;async isAvailable(){return"speechSynthesis"in window}async speak(e,t){if(!("speechSynthesis"in window))throw new Error("Speech synthesis not supported in this browser");return this.isPlaying&&this.stop(),new Promise((s,n)=>{if(this.currentUtterance=new SpeechSynthesisUtterance(e),t?.voice){const i=speechSynthesis.getVoices().find(u=>u.name.toLowerCase().includes(t.voice.toLowerCase())||u.voiceURI.toLowerCase().includes(t.voice.toLowerCase()));i&&(this.currentUtterance.voice=i)}t?.rate!==void 0&&(this.currentUtterance.rate=Math.max(.1,Math.min(10,t.rate))),t?.pitch!==void 0&&(this.currentUtterance.pitch=Math.max(0,Math.min(2,t.pitch))),t?.volume!==void 0&&(this.currentUtterance.volume=Math.max(0,Math.min(1,t.volume))),this.currentUtterance.onstart=()=>{this.isPlaying=!0,this.isPaused=!1,this.startCallback?.()},this.currentUtterance.onend=()=>{this.isPlaying=!1,this.isPaused=!1,this.currentUtterance=null,this.endCallback?.(),s()},this.currentUtterance.onerror=a=>{this.isPlaying=!1,this.isPaused=!1,this.currentUtterance=null;const i=new Error(`Speech synthesis error: ${a.error}`);this.errorCallback?.(i),n(i)},this.currentUtterance.onpause=()=>{this.isPaused=!0},this.currentUtterance.onresume=()=>{this.isPaused=!1};try{speechSynthesis.speak(this.currentUtterance)}catch(a){this.currentUtterance=null,n(a)}})}stop(){"speechSynthesis"in window&&speechSynthesis.cancel(),this.isPlaying=!1,this.isPaused=!1,this.currentUtterance=null}pause(){"speechSynthesis"in window&&this.isPlaying&&!this.isPaused&&(speechSynthesis.pause(),this.isPaused=!0)}resume(){"speechSynthesis"in window&&this.isPaused&&(speechSynthesis.resume(),this.isPaused=!1)}async getVoices(){return"speechSynthesis"in window?new Promise(e=>{let t=speechSynthesis.getVoices();t.length===0?speechSynthesis.onvoiceschanged=()=>{t=speechSynthesis.getVoices(),e(this.mapSystemVoices(t))}:e(this.mapSystemVoices(t))}):[]}mapSystemVoices(e){return e.map(t=>({id:t.voiceURI,name:t.name,lang:t.lang,gender:this.inferGender(t.name)}))}inferGender(e){const t=e.toLowerCase(),s=["female","woman","girl","aria","zira","hazel","susan","karen","samantha"],n=["male","man","boy","david","mark","daniel","alex","tom"];return s.some(a=>t.includes(a))?"female":n.some(a=>t.includes(a))?"male":"neutral"}onStart(e){this.startCallback=e}onEnd(e){this.endCallback=e}onError(e){this.errorCallback=e}}class E{static instance;sttCache=new Map;ttsCache=new Map;constructor(){}static getInstance(){return E.instance||(E.instance=new E),E.instance}async getSTT(e){if(e.sttProvider==="none")return null;const t=`${e.sttProvider}-${JSON.stringify(e.apiKeys)}`;if(this.sttCache.has(t))return this.sttCache.get(t);let s;switch(e.sttProvider){case"whisper":if(!e.apiKeys?.whisper&&!e.apiKeys?.openai)throw new Error("Whisper API key is required for Whisper STT");s=new ce(e.apiKeys.whisper||e.apiKeys.openai);break;case"vosk":s=new le;break;default:throw new Error(`Unknown STT provider: ${e.sttProvider}`)}if(!await s.isAvailable())throw new Error(`STT adapter ${e.sttProvider} is not available`);return this.sttCache.set(t,s),s}async getTTS(e){if(e.ttsProvider==="none")return null;const t=`${e.ttsProvider}-${JSON.stringify(e.apiKeys)}-${JSON.stringify(e.voiceSettings)}`;if(this.ttsCache.has(t))return this.ttsCache.get(t);let s;switch(e.ttsProvider){case"openai":if(!e.apiKeys?.openai)throw new Error("OpenAI API key is required for OpenAI TTS");s=new ue(e.apiKeys.openai);break;case"edge":s=new de;break;case"system":s=new pe;break;default:throw new Error(`Unknown TTS provider: ${e.ttsProvider}`)}if(!await s.isAvailable())throw new Error(`TTS adapter ${e.ttsProvider} is not available`);return this.ttsCache.set(t,s),s}async testSTTAvailability(e,t){try{const s={sttProvider:e,ttsProvider:"none",...t?{apiKeys:{[e==="whisper"?"whisper":"vosk"]:t}}:{}};return await this.getSTT(s)!==null}catch{return!1}}async testTTSAvailability(e,t){try{const s={sttProvider:"none",ttsProvider:e,...t?{apiKeys:{openai:t}}:{}};return await this.getTTS(s)!==null}catch{return!1}}clearCache(){this.sttCache.forEach(e=>e.cleanup?.()),this.ttsCache.forEach(e=>e.stop?.()),this.sttCache.clear(),this.ttsCache.clear()}async getAvailableProviders(){const e=[{provider:"whisper",requiresApiKey:!0},{provider:"vosk",requiresApiKey:!1}],t=[{provider:"openai",requiresApiKey:!0},{provider:"edge",requiresApiKey:!1},{provider:"system",requiresApiKey:!1}],s=await Promise.all(e.map(async({provider:a,requiresApiKey:i})=>({provider:a,available:await this.testSTTAvailability(a),requiresApiKey:i}))),n=await Promise.all(t.map(async({provider:a,requiresApiKey:i})=>({provider:a,available:await this.testTTSAvailability(a),requiresApiKey:i})));return{stt:s,tts:n}}}const he=r=>E.getInstance().getSTT(r),me=r=>E.getInstance().getTTS(r),ge=r=>{const[e,t]=l.useState(null),[s,n]=l.useState(!1),[a,i]=l.useState(!1),[u,c]=l.useState(null),[m,g]=l.useState(null),[p,h]=l.useState([]),d=l.useRef(null),x=l.useRef(null);l.useEffect(()=>{let y=!0;return(async()=>{if(r.sttProvider==="none"){t(null);return}i(!0),c(null);try{const C=await he(r);if(!y)return;C&&(C.onResult(T=>{y&&(g(T),T.isFinal?h([]):h(b=>[...b.slice(-4),T]),d.current?.(T))}),C.onError(T=>{y&&(c(T.message),n(!1),x.current?.(T))})),t(C)}catch(C){y&&c(C instanceof Error?C.message:"Failed to initialize STT adapter")}finally{y&&i(!1)}})(),()=>{y=!1,e?.cleanup()}},[r.sttProvider,r.apiKeys?.whisper,r.apiKeys?.openai]);const w=l.useCallback(async()=>{if(!(!e||s))try{c(null),h([]),await e.startRecording(),n(!0)}catch(y){c(y instanceof Error?y.message:"Failed to start recording")}},[e,s]),R=l.useCallback(async()=>{if(!(!e||!s))try{await e.stopRecording(),n(!1)}catch(y){c(y instanceof Error?y.message:"Failed to stop recording"),n(!1)}},[e,s]),k=l.useCallback(y=>{d.current=y},[]),j=l.useCallback(y=>{x.current=y},[]);return{adapter:e,isRecording:s,isLoading:a,error:u,lastResult:m,partialResults:p,startRecording:w,stopRecording:R,onResult:k,onError:j,isAvailable:!!e}},fe=r=>{const[e,t]=l.useState(null),[s,n]=l.useState(!1),[a,i]=l.useState(!1),[u,c]=l.useState(!1),[m,g]=l.useState(null),[p,h]=l.useState(null),d=l.useRef(null),x=l.useRef(null),w=l.useRef(null);l.useEffect(()=>{let b=!0;return(async()=>{if(r.ttsProvider==="none"){t(null);return}c(!0),g(null);try{const S=await me(r);if(!b)return;S&&(S.onStart?.(()=>{b&&(n(!0),i(!1),d.current?.())}),S.onEnd?.(()=>{b&&(n(!1),i(!1),h(null),x.current?.())}),S.onError?.(M=>{b&&(g(M.message),n(!1),i(!1),h(null),w.current?.(M))})),t(S)}catch(S){b&&g(S instanceof Error?S.message:"Failed to initialize TTS adapter")}finally{b&&c(!1)}})(),()=>{b=!1,e?.stop()}},[r.ttsProvider,r.apiKeys?.openai,r.voiceSettings]);const R=l.useCallback(async(b,L)=>{if(e)try{g(null),h(b),await e.speak(b,{...r.voiceSettings,...L})}catch(S){g(S instanceof Error?S.message:"Failed to speak text"),h(null)}},[e,r.voiceSettings]),k=l.useCallback(()=>{e&&(e.stop(),n(!1),i(!1),h(null))},[e]),j=l.useCallback(()=>{!e||!s||(e.pause(),i(!0))},[e,s]),y=l.useCallback(()=>{!e||!a||(e.resume(),i(!1))},[e,a]),U=l.useCallback(b=>{d.current=b},[]),C=l.useCallback(b=>{x.current=b},[]),T=l.useCallback(b=>{w.current=b},[]);return{adapter:e,isPlaying:s,isPaused:a,isLoading:u,error:m,currentText:p,speak:R,stop:k,pause:j,resume:y,onStart:U,onEnd:C,onError:T,isAvailable:!!e}},ye=r=>{const e=ge(r),t=fe(r),s=e.isLoading||t.isLoading,n=!!e.error||!!t.error,a=[e.error,t.error].filter(Boolean);return{stt:e,tts:t,isLoading:s,hasError:n,errors:a,isReady:e.isAvailable||t.isAvailable}};var V={};const be=["idle","capture","parseIntent","route","execute","verify","respond","recover"],xe=r=>{const e=l.useCallback(d=>({sttProvider:d.sttProvider==="whisper"?"whisper":d.sttProvider==="vosk"?"vosk":"none",ttsProvider:d.ttsProvider==="system"?"system":d.ttsProvider==="elevenlabs"?"edge":d.ttsProvider==="openai"?"openai":"none",apiKeys:{openai:V.REACT_APP_OPENAI_API_KEY,whisper:V.REACT_APP_OPENAI_API_KEY}}),[]),[t,s,n]=X(oe),a=e(t.context.settings),i=ye(a),u=t.value,c=t.context,m={currentState:u,isVisible:c.isVisible,isRecording:c.isRecording,isProcessing:["parseIntent","route","execute","verify","respond"].includes(u),input:c.input,result:c.result,error:c.error,intent:c.intent,settings:c.settings,inputMode:c.inputMode,executionResult:c.executionResult,canSubmitText:u==="idle"&&c.isVisible,canStartVoice:u==="idle"&&c.isVisible&&c.settings.sttProvider!=="none",showStepBadges:u!=="idle",currentStep:be.indexOf(u),sttAvailable:i.stt.isAvailable,ttsAvailable:i.tts.isAvailable,sttError:null,ttsError:null},g={toggleVisibility:l.useCallback(()=>{s({type:"HOTKEY_TOGGLE"})},[s]),submitText:l.useCallback(d=>{s({type:"TEXT_SUBMIT",text:d})},[s]),startCapture:l.useCallback(async()=>{if(i.stt.isAvailable)try{await i.stt.startRecording(),s({type:"START_CAPTURE"})}catch(d){console.error("Failed to start STT recording:",d)}else s({type:"START_CAPTURE"})},[s,i.stt]),cancel:l.useCallback(async()=>{i.stt.isRecording&&await i.stt.stopRecording(),i.tts.isPlaying&&i.tts.stop(),s({type:"CANCEL"})},[s,i.stt,i.tts]),updateSettings:l.useCallback(d=>{s({type:"UPDATE_SETTINGS",settings:d})},[s]),confirmExecution:l.useCallback(()=>{s({type:"VERIFY_OK"})},[s]),cancelExecution:l.useCallback(()=>{s({type:"VERIFY_ERR"})},[s]),triggerSTTResult:l.useCallback(d=>{s({type:"STT_RESULT",text:d})},[s]),triggerIntentParsed:l.useCallback(d=>{s({type:"INTENT_PARSED",intent:d})},[s]),triggerExecutionResult:l.useCallback(d=>{d.success?s({type:"EXEC_OK",result:d}):s({type:"EXEC_ERR",message:d.message})},[s])},p=l.useCallback(()=>{n.start()},[n]),h=l.useCallback(()=>{n.stop()},[n]);return l.useEffect(()=>{i.stt.isAvailable&&(i.stt.onResult(d=>{d.isFinal&&s({type:"STT_RESULT",text:d.text})}),i.stt.onError(d=>{console.error("STT Error:",d),s({type:"CANCEL"})}))},[i.stt.isAvailable,s]),l.useEffect(()=>{i.tts.isAvailable&&(i.tts.onStart(()=>{console.log("TTS started")}),i.tts.onEnd(()=>{console.log("TTS ended")}),i.tts.onError(d=>{console.error("TTS Error:",d)}))},[i.tts.isAvailable]),l.useEffect(()=>{const d=x=>{(x.ctrlKey||x.metaKey)&&x.key==="'"&&(x.preventDefault(),g.toggleVisibility())};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[g.toggleVisibility]),l.useEffect(()=>(p(),()=>h()),[p,h]),{selectors:{...m,sttAvailable:i.stt.isAvailable,ttsAvailable:i.tts.isAvailable,sttError:i.stt.error,ttsError:i.tts.error},actions:g,start:p,stop:h,state:t,send:s,adapters:i}},ve=()=>{const r=l.useCallback(async s=>{console.log("TTS request:",s)},[]),e=l.useCallback(async(s,n)=>{const{postJSON:a}=await A(async()=>{const{postJSON:i}=await Promise.resolve().then(()=>Ne);return{postJSON:i}},void 0);return a(s,n)},[]),t=l.useCallback(s=>{console.error("Assistant Error:",s)},[]);return{speak:r,postJSON:e,showError:t,startRecording:async()=>{console.log("Start recording requested")},stopRecording:async()=>{console.log("Stop recording requested")},isRecordingAvailable:async()=>!1,isSpeechAvailable:async()=>!1,getSystemInfo:async()=>({}),isBackendAvailable:async()=>!1,showNotification:(s,n)=>{console.log(`Notification: ${s} - ${n}`)},requestNotificationPermission:async()=>!1}},we=(r=10)=>{const[e,t]=l.useState({isActive:!1,current:void 0,history:[],canCancel:!1}),s=l.useRef(null),n=l.useCallback(()=>{t(p=>({...p,isActive:!0,current:void 0,canCancel:!0}))},[]),a=l.useCallback(p=>{t(h=>{const d=[...h.history];return(p.phase==="complete"||p.phase==="error"||p.progress===100||p.progress===0)&&(d.push(p),d.length>r&&d.shift()),{...h,current:p,history:d,canCancel:p.phase==="processing"||p.phase==="starting"}})},[r]),i=l.useCallback(()=>{t(p=>({...p,isActive:!1,canCancel:!1})),s.current=null},[]),u=l.useCallback(()=>{s.current&&s.current(),t(p=>({...p,isActive:!1,canCancel:!1,current:p.current?{...p.current,phase:"error",message:"Operation cancelled by user",progress:0}:void 0})),s.current=null},[]),c=l.useCallback(()=>{t(p=>({...p,history:[]}))},[]),m=l.useCallback(p=>{s.current=p},[]);return{progressState:e,controls:{startProgress:n,updateProgress:a,completeProgress:i,cancelProgress:u,clearHistory:c},setCancelHandler:m}},Se={idle:"Ready",capture:"Capture",parseIntent:"Parse",route:"Route",execute:"Execute",verify:"Verify",respond:"Respond",recover:"Recover"},Ce={idle:{active:"bg-gray-500",completed:"bg-gray-400",pending:"bg-gray-200"},capture:{active:"bg-blue-500",completed:"bg-blue-400",pending:"bg-gray-200"},parseIntent:{active:"bg-purple-500",completed:"bg-purple-400",pending:"bg-gray-200"},route:{active:"bg-indigo-500",completed:"bg-indigo-400",pending:"bg-gray-200"},execute:{active:"bg-orange-500",completed:"bg-orange-400",pending:"bg-gray-200"},verify:{active:"bg-yellow-500",completed:"bg-yellow-400",pending:"bg-gray-200"},respond:{active:"bg-green-500",completed:"bg-green-400",pending:"bg-gray-200"},recover:{active:"bg-red-500",completed:"bg-red-400",pending:"bg-gray-200"}},q=({step:r,currentState:e,isVisible:t=!0})=>{if(!t)return null;const s=e===r,n=_(e)>_(r)&&e!=="idle",a=_(e)<_(r),i=Ce[r],u=s?i.active:n?i.completed:i.pending,c=s||n?"text-white":"text-gray-600";return o.jsx("div",{className:`
      px-3 py-1 rounded-full text-xs font-medium transition-all duration-300 transform
      ${u} ${c}
      ${s?"shadow-lg scale-105 animate-pulse":""}
      ${n?"shadow-md":""}
      ${a?"opacity-60":"opacity-100"}
    `,children:o.jsxs("span",{className:"flex items-center gap-1",children:[n&&o.jsx("span",{className:"text-xs",children:"✓"}),s&&o.jsx("span",{className:"text-xs animate-spin",children:"⟳"}),Se[r]]})})};function _(r){return{idle:0,capture:1,parseIntent:2,route:3,execute:4,verify:5,respond:6,recover:7}[r]??0}const Te=({currentState:r,showStepBadges:e})=>{const t=["capture","parseIntent","route","execute","verify","respond"];return e?o.jsxs("div",{className:"flex justify-center space-x-2 mb-6 flex-wrap gap-2",children:[t.map(s=>o.jsx(q,{step:s,currentState:r,isVisible:e},s)),r==="recover"&&o.jsx(q,{step:"recover",currentState:r,isVisible:!0})]}):null},Pe=({isOpen:r,onClose:e,settings:t,onSettingsChange:s})=>{if(!r)return null;const n=(a,i)=>{s({...t,[a]:i})};return o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:o.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-w-md mx-4",children:[o.jsxs("div",{className:"flex justify-between items-center mb-4",children:[o.jsx("h2",{className:"text-xl font-semibold",children:"Settings"}),o.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Speech-to-Text Provider"}),o.jsxs("select",{value:t.sttProvider,onChange:a=>n("sttProvider",a.target.value),className:"w-full p-2 border rounded-md",children:[o.jsx("option",{value:"whisper",children:"Whisper (Cloud)"}),o.jsx("option",{value:"vosk",children:"Vosk (Offline)"}),o.jsx("option",{value:"none",children:"Disabled"})]})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("label",{className:"text-sm font-medium",children:"Allow Cloud NLP"}),o.jsx("input",{type:"checkbox",checked:t.allowCloudNLP,onChange:a=>n("allowCloudNLP",a.target.checked),className:"w-4 h-4"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",children:"Text-to-Speech Provider"}),o.jsxs("select",{value:t.ttsProvider,onChange:a=>n("ttsProvider",a.target.value),className:"w-full p-2 border rounded-md",children:[o.jsx("option",{value:"system",children:"System TTS"}),o.jsx("option",{value:"elevenlabs",children:"ElevenLabs"}),o.jsx("option",{value:"openai",children:"OpenAI TTS"}),o.jsx("option",{value:"none",children:"Disabled"})]})]})]}),o.jsx("div",{className:"flex justify-end mt-6",children:o.jsx("button",{onClick:e,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"Save"})})]})})},ke=({progress:r,className:e=""})=>{const t=a=>{switch(a){case"starting":return"text-blue-400";case"processing":return"text-yellow-400";case"completing":return"text-green-400";case"complete":return"text-green-400";case"error":return"text-red-400";default:return"text-gray-400"}},s=a=>{switch(a){case"starting":return"🚀";case"processing":return"⚙️";case"completing":return"✨";case"complete":return"✅";case"error":return"❌";default:return"⏳"}},n=a=>{switch(a){case"starting":return"bg-blue-500";case"processing":return"bg-yellow-500";case"completing":return"bg-green-500";case"complete":return"bg-green-500";case"error":return"bg-red-500";default:return"bg-gray-500"}};return o.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 ${e}`,children:[o.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[o.jsx("span",{className:"text-lg",children:s(r.phase)}),o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:`text-sm font-medium ${t(r.phase)}`,children:r.message}),r.details&&o.jsx("div",{className:"text-xs text-gray-400 mt-1",children:typeof r.details=="string"?r.details:JSON.stringify(r.details,null,2)})]}),o.jsxs("div",{className:"text-xs text-gray-400 font-mono",children:[Math.round(r.progress),"%"]})]}),o.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:o.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${n(r.phase)}`,style:{width:`${Math.max(0,Math.min(100,r.progress))}%`}})}),o.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-2",children:[o.jsx("span",{className:r.phase==="starting"?t("starting"):"",children:"Start"}),o.jsx("span",{className:r.phase==="processing"?t("processing"):"",children:"Process"}),o.jsx("span",{className:r.phase==="completing"?t("completing"):"",children:"Complete"})]})]})},Ee=({isVisible:r,progress:e,onCancel:t})=>!r||!e?null:o.jsxs("div",{className:"animate-slide-up",children:[o.jsx(ke,{progress:e}),e.phase==="processing"&&t&&o.jsx("div",{className:"mt-3 flex justify-end",children:o.jsx("button",{onClick:t,className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm transition-colors",children:"Cancel"})})]}),Re=({progressHistory:r,maxItems:e=5,className:t=""})=>{const s=r.slice(-e);return s.length===0?null:o.jsxs("div",{className:`space-y-2 ${t}`,children:[o.jsx("div",{className:"text-xs text-gray-400 font-semibold",children:"Progress History"}),s.map((n,a)=>o.jsxs("div",{className:"bg-gray-900 rounded p-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("span",{className:"text-xs text-gray-300",children:n.message}),o.jsxs("span",{className:"text-xs text-gray-500",children:[Math.round(n.progress),"%"]})]}),o.jsx("div",{className:"w-full bg-gray-700 rounded-full h-1 mt-1",children:o.jsx("div",{className:"h-1 rounded-full bg-gray-500",style:{width:`${n.progress}%`}})})]},a))]})};class Ae{baseURL;defaultTimeout;defaultRetries;defaultRetryDelay;constructor(e="http://localhost:8000"){this.baseURL=e.replace(/\/$/,""),this.defaultTimeout=3e4,this.defaultRetries=3,this.defaultRetryDelay=1e3}async postJSON(e,t,s={}){const{timeout:n=this.defaultTimeout,retries:a=this.defaultRetries,retryDelay:i=this.defaultRetryDelay,signal:u,onProgress:c}=s,m=`${this.baseURL}${e.startsWith("/")?e:`/${e}`}`;c?.({phase:"connecting",progress:0,message:"Connecting to server..."});let g=null;for(let p=1;p<=a;p++)try{const h=new AbortController,d=setTimeout(()=>h.abort(),n),x=u?this.combineSignals([u,h.signal]):h.signal;c?.({phase:"uploading",progress:10,message:`Sending request (attempt ${p}/${a})...`});const w=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t),signal:x});if(clearTimeout(d),c?.({phase:"processing",progress:50,message:"Processing request..."}),!w.ok){const k=await this.parseErrorResponse(w);throw new v(k.code||`HTTP_${w.status}`,k.message||w.statusText,w.status,k.details)}c?.({phase:"downloading",progress:80,message:"Receiving response..."});const R=await w.json();return c?.({phase:"complete",progress:100,message:"Request completed successfully"}),R}catch(h){if(g=h,h instanceof v&&h.status&&h.status>=400&&h.status<500)throw h;if(h instanceof DOMException&&h.name==="AbortError")throw new v("REQUEST_ABORTED","Request was aborted",0,{attempt:p,totalAttempts:a});if(p===a)break;c?.({phase:"connecting",progress:0,message:`Retrying in ${i}ms... (attempt ${p+1}/${a})`}),await this.delay(i*p)}throw c?.({phase:"error",progress:0,message:"Request failed after all retries"}),g instanceof v?g:new v("REQUEST_FAILED",g?.message||"Request failed after all retries",0,{attempts:a,lastError:g?.message})}async parseErrorResponse(e){try{const t=e.headers.get("content-type");if(t&&t.includes("application/json"))return await e.json();{const s=await e.text();return{code:`HTTP_${e.status}`,message:s||e.statusText}}}catch{return{code:`HTTP_${e.status}`,message:e.statusText}}}combineSignals(e){const t=new AbortController;for(const s of e){if(s.aborted){t.abort();break}s.addEventListener("abort",()=>t.abort())}return t.signal}delay(e){return new Promise(t=>setTimeout(t,e))}async healthCheck(){try{return(await this.postJSON("/health",{},{timeout:5e3,retries:1})).status==="healthy"}catch{return!1}}async getServerInfo(){return this.postJSON("/health",{},{timeout:5e3})}}class v extends Error{code;status;details;constructor(e,t,s,n){super(t),this.name="APIError",this.code=e,this.status=s,this.details=n}isNetworkError(){return this.code==="REQUEST_FAILED"||this.code==="REQUEST_ABORTED"||!this.status}isClientError(){return this.status?this.status>=400&&this.status<500:!1}isServerError(){return this.status?this.status>=500:!1}getUserMessage(){return this.isNetworkError()?"Unable to connect to the server. Please check your connection and try again.":this.isClientError()?this.message||"Invalid request. Please check your input and try again.":this.isServerError()?"Server error occurred. Please try again later.":this.message||"An unexpected error occurred."}}const P=new Ae,_e=(r,e,t)=>P.postJSON(r,e,t),Ne=Object.freeze(Object.defineProperty({__proto__:null,APIError:v,apiClient:P,postJSON:_e},Symbol.toStringTag,{value:"Module"}));class G{constructor(e="http://localhost:8000"){}async executeIntent(e,t){try{switch(t?.({phase:"starting",progress:0,message:`Starting ${e.intent} operation...`}),e.intent){case"CreateFile":return await this.createFile(e.parameters,t);case"OpenItem":return await this.openItem(e.parameters,t);case"AnalyzeSpreadsheet":return await this.analyzeSpreadsheet(e.parameters,t);case"SummarizeDoc":return await this.summarizeDocument(e.parameters,t);default:throw new Error(`Unsupported intent: ${e.intent}`)}}catch(s){const n=s instanceof v?s.getUserMessage():s instanceof Error?s.message:"Unknown error occurred";return t?.({phase:"error",progress:0,message:`Failed: ${n}`,details:s}),{success:!1,message:n,error:n}}}async createFile(e,t){const{title:s,path:n,content:a}=e;t?.({phase:"processing",progress:25,message:`Creating file "${s}"...`});try{const i=await P.postJSON("/create_file",{title:s,path:n,content:a||""},{onProgress:u=>{t?.({phase:"processing",progress:25+u.progress*.5,message:u.message})}});return t?.({phase:"complete",progress:100,message:`File "${s}" created successfully`}),{success:!0,message:`File "${s}" created at ${i.data?.file_path}`,data:i.data,requiresVerification:!1}}catch(i){if(i instanceof v&&i.status===409)return{success:!1,message:`File "${s}" already exists`,error:"File already exists",requiresVerification:!1};throw i}}async openItem(e,t){const{query:s,type:n="auto"}=e;t?.({phase:"processing",progress:25,message:`Searching for "${s}"...`});try{const a=await P.postJSON("/open_item",{query:s,type:n},{onProgress:i=>{t?.({phase:"processing",progress:25+i.progress*.5,message:i.message})}});return t?.({phase:"complete",progress:100,message:`Opened "${s}" successfully`}),{success:!0,message:`Opened "${s}" (${a.data?.type})`,data:a.data,requiresVerification:!1}}catch(a){if(a instanceof v&&a.status===404)return{success:!1,message:`Could not find "${s}"`,error:"Item not found",requiresVerification:!1};throw a}}async analyzeSpreadsheet(e,t){const{path:s,op:n,column:a}=e;t?.({phase:"processing",progress:20,message:`Loading spreadsheet "${s}"...`});try{const i=await P.postJSON("/analyze_sheet",{path:s,op:n,column:a},{timeout:6e4,onProgress:m=>{let g=m.message;m.phase==="processing"&&(g=`Analyzing ${a} column...`),t?.({phase:"processing",progress:20+m.progress*.6,message:g})}});return t?.({phase:"complete",progress:100,message:`Analysis complete: ${i.result}`}),{success:!0,message:`${{sum:"Sum",avg:"Average",count:"Count",total:"Total"}[n]||n} of "${i.matched_column}": ${i.result} (${i.cells_count} cells)`,data:{result:i.result,matchedColumn:i.matched_column,cellsCount:i.cells_count,operation:n},requiresVerification:!1}}catch(i){if(i instanceof v&&i.status===404)return{success:!1,message:`Spreadsheet file "${s}" not found`,error:"File not found",requiresVerification:!1};if(i instanceof v&&i.status===400)return{success:!1,message:`Invalid operation: ${i.message}`,error:i.message,requiresVerification:!1};throw i}}async summarizeDocument(e,t){const{path:s,length:n="short"}=e;t?.({phase:"processing",progress:15,message:`Loading document "${s}"...`});try{const a=await P.postJSON("/summarize_doc",{path:s,length:n},{timeout:12e4,onProgress:c=>{let m=c.message;c.phase==="processing"&&(c.progress<30?m="Extracting text from PDF...":c.progress<70?m="Generating summary...":m="Finalizing summary..."),t?.({phase:"processing",progress:15+c.progress*.7,message:m})}});return t?.({phase:"complete",progress:100,message:`Document summarized (${a.word_count} words)`}),{success:!0,message:`${{short:"Short summary",bullets:"Bullet points",tweet:"Tweet-length summary"}[n]||"Summary"} generated (${a.word_count} words)`,data:{summary:a.summary,lengthType:a.length_type,wordCount:a.word_count},requiresVerification:!1}}catch(a){if(a instanceof v&&a.status===404)return{success:!1,message:`PDF file "${s}" not found`,error:"File not found",requiresVerification:!1};throw a}}async testConnection(){try{return await P.healthCheck()}catch{return!1}}async getServerInfo(){try{return await P.getServerInfo()}catch(e){throw e}}}const $=new G,je=(r,e)=>$.executeIntent(r,e),Ie=Object.freeze(Object.defineProperty({__proto__:null,RouterActions:G,executeIntent:je,routerActions:$},Symbol.toStringTag,{value:"Module"}));class H{tools=new Map;routingRules=[];fallbackTool="create_file";constructor(){this.initializeTools(),this.initializeRouting()}initializeTools(){[{name:"create_file",description:"Create a new file with optional content in a specified location",schema:{type:"object",properties:{title:{type:"string",description:"Name of the file to create"},path:{type:"string",description:"Optional directory path"},content:{type:"string",description:"Optional initial content"}},required:["title"]},examples:[{title:"notes.txt",content:"Meeting notes..."},{title:"config.json",path:"./settings",content:"{}"}]},{name:"open_item",description:"Open a file, application, or folder using the system default handler",schema:{type:"object",properties:{query:{type:"string",description:"Search query for the item to open"},type:{type:"string",enum:["file","application","folder","auto"],default:"auto"}},required:["query"]},examples:[{query:"budget.xlsx",type:"file"},{query:"Visual Studio Code",type:"application"}]},{name:"analyze_sheet",description:"Perform mathematical operations on spreadsheet data",schema:{type:"object",properties:{path:{type:"string",description:"Path to spreadsheet file"},op:{type:"string",enum:["sum","avg","count","total"]},column:{type:"string",description:"Column name to analyze"}},required:["path","op","column"]},examples:[{path:"data.csv",op:"sum",column:"amount"},{path:"sales.xlsx",op:"avg",column:"revenue"}]},{name:"summarize_doc",description:"Extract text from PDF documents and generate summaries",schema:{type:"object",properties:{path:{type:"string",description:"Path to PDF document"},length:{type:"string",enum:["short","bullets","tweet"],default:"short"}},required:["path"]},examples:[{path:"report.pdf",length:"bullets"},{path:"paper.pdf",length:"short"}]}].forEach(t=>{this.tools.set(t.name,t)})}initializeRouting(){this.routingRules=[{tool:"analyze_sheet",triggers:["sum","total","average","avg","count","calculate","add up","spreadsheet","csv","excel"],patterns:[".*\\b(sum|total|average|avg|count|calculate)\\b.*\\b(column|data|spreadsheet|csv|excel)\\b.*",".*\\b(add up|total up)\\b.*",".*\\.(csv|xlsx|xls|ods)\\b.*\\b(sum|total|average|count)\\b.*"],priority:90},{tool:"summarize_doc",triggers:["summarize","summary","explain","find in pdf","pdf","document","bullet points"],patterns:[".*\\b(summarize|summary)\\b.*\\b(pdf|document)\\b.*",".*\\b(explain|describe)\\b.*\\b(pdf|document)\\b.*",".*\\b(find|search)\\b.*\\b(in|pdf)\\b.*",".*\\.(pdf)\\b.*\\b(summarize|summary|explain|bullet)\\b.*"],priority:85},{tool:"open_item",triggers:["open","launch","start","run","execute","show"],patterns:[".*\\b(open|launch|start|run|execute)\\b.*",".*\\b(show|display)\\b.*\\b(file|folder|application|app)\\b.*"],priority:80},{tool:"create_file",triggers:["create","make","write","new file","generate"],patterns:[".*\\b(create|make|write|generate)\\b.*\\b(file|document)\\b.*",".*\\b(new)\\b.*\\b(file|document|text)\\b.*"],priority:75}]}analyzeInput(e){const t=e.toLowerCase(),s=[];for(const n of this.routingRules){const a=[];let i=!1;for(const u of n.triggers)t.includes(u.toLowerCase())&&(i=!0,a.push(`trigger:${u}`));for(const u of n.patterns)try{new RegExp(u,"i").test(e)&&(i=!0,a.push(`pattern:${u}`))}catch{console.warn("Invalid regex pattern:",u)}i&&s.push({tool:n.tool,priority:n.priority,patterns:a})}if(s.length>0){s.sort((i,u)=>u.priority-i.priority);const n=s[0],a=Math.min(.95,n.priority/100+n.patterns.length*.1);return{tool:n.tool,confidence:a,matchedPatterns:n.patterns}}return{tool:this.fallbackTool,confidence:.3,matchedPatterns:["fallback"]}}async executeTool(e,t,s){const n=Date.now();try{if(!this.tools.get(e))return{success:!1,message:`Unknown tool: ${e}`,error:`Unknown tool: ${e}`,error_code:"UNKNOWN_TOOL",suggestions:[{type:"alternative",message:`Available tools: ${Array.from(this.tools.keys()).join(", ")}`,example:"Try using one of the available tools"}]};const u={intent:{create_file:"CreateFile",open_item:"OpenItem",analyze_sheet:"AnalyzeSpreadsheet",summarize_doc:"SummarizeDoc"}[e]||"CreateFile",confidence:.9,parameters:t,context:{sessionId:"kiro-agent",timestamp:new Date().toISOString(),userInput:`${e} execution`}},c=await $.executeIntent(u,s),m=Date.now()-n;return c.success?{success:!0,tool:e,message:c.message,data:c.data,execution_time:m,metadata:{confidence:.9,matched_patterns:["direct_execution"]}}:{success:!1,message:c.error||c.message||"Tool execution failed",tool:e,error:c.error||c.message,error_code:"EXECUTION_FAILED",execution_time:m,metadata:{attempted_tool:e,error_details:c},suggestions:this.generateErrorSuggestions(e,c.error||c.message)}}catch(a){const i=Date.now()-n;return{success:!1,message:a instanceof Error?a.message:"Unknown error",tool:e,error:a instanceof Error?a.message:"Unknown error",error_code:"EXECUTION_ERROR",execution_time:i,metadata:{attempted_tool:e,error_details:{error:a instanceof Error?a.message:a}},suggestions:this.generateErrorSuggestions(e,a instanceof Error?a.message:"Unknown error")}}}async processInput(e,t){const s=this.analyzeInput(e),n=this.extractParameters(s.tool,e),a=await this.executeTool(s.tool,n,t);return a.metadata&&(a.metadata.confidence=s.confidence,a.metadata.matched_patterns=s.matchedPatterns,a.metadata.alternative_tools=this.getAlternativeTools(s.tool)),a}extractParameters(e,t){switch(e){case"create_file":return this.extractCreateFileParams(t);case"open_item":return this.extractOpenItemParams(t);case"analyze_sheet":return this.extractAnalyzeSheetParams(t);case"summarize_doc":return this.extractSummarizeDocParams(t);default:return{}}}extractCreateFileParams(e){const t={},s=e.match(/(?:create|make|write|new)\s+(?:file\s+)?(?:called\s+|named\s+)?[\"']?([^\s\"']+\.[a-zA-Z0-9]+)[\"']?/i);s?t.title=s[1]:t.title="untitled.txt";const n=e.match(/(?:in|at|to)\s+[\"']?([^\s\"']+)[\"']?/i);n&&(t.path=n[1]);const a=e.match(/(?:with|containing)\s+[\"']([^\"']+)[\"']/i);return a&&(t.content=a[1]),t}extractOpenItemParams(e){const t={},s=e.match(/(?:open|launch|start|run|show)\s+[\"']?([^\"']+)[\"']?/i);return s?t.query=s?.[1]?.trim()||"":t.query=e.replace(/^(open|launch|start|run|show)\s+/i,"").trim(),e.match(/\.(exe|app|dmg)$/i)||e.match(/\b(application|app|program)\b/i)?t.type="application":e.match(/\b(folder|directory)\b/i)?t.type="folder":e.match(/\.(txt|pdf|xlsx|csv|docx|jpg|png|gif)$/i)?t.type="file":t.type="auto",t}extractAnalyzeSheetParams(e){const t={},s=e.match(/[\"']?([^\s\"']+\.(csv|xlsx|xls|ods))[\"']?/i);s?t.path=s[1]:t.path="data.csv",e.match(/\b(sum|total|add up)\b/i)?t.op="sum":e.match(/\b(average|avg|mean)\b/i)?t.op="avg":e.match(/\bcount\b/i)?t.op="count":t.op="sum";const n=e.match(/(?:column|field)\s+[\"']?([^\s\"']+)[\"']?/i)||e.match(/\b(salary|revenue|amount|price|cost|value|quantity|total)\b/i);return n?t.column=n[1]:t.column="value",t}extractSummarizeDocParams(e){const t={},s=e.match(/[\"']?([^\s\"']+\.pdf)[\"']?/i);return s?t.path=s[1]:t.path="document.pdf",e.match(/\b(bullet|bullets|bullet points|key points)\b/i)?t.length="bullets":e.match(/\b(tweet|short|brief|concise)\b/i)?t.length="tweet":t.length="short",t}generateErrorSuggestions(e,t){const s=[];return t.includes("not found")&&s.push({type:"clarify",message:"The file or item could not be found. Please check the path and try again.",example:"Make sure the file exists and the path is correct"}),t.includes("permission")&&s.push({type:"alternative",message:"Permission denied. Try running with appropriate permissions.",example:"Check file permissions or try a different location"}),e==="analyze_sheet"&&t.includes("column")&&s.push({type:"rephrase",message:"Column not found. Try using a different column name.",example:'Use exact column names like "Amount" or "Revenue"'}),s}getAlternativeTools(e){return{create_file:["open_item"],open_item:["create_file"],analyze_sheet:["summarize_doc"],summarize_doc:["analyze_sheet"]}[e]||[]}getAvailableTools(){return Array.from(this.tools.values())}getToolSchema(e){return this.tools.get(e)?.schema}}const Oe=new H,K=Object.freeze(Object.defineProperty({__proto__:null,KiroAgent:H,kiroAgent:Oe},Symbol.toStringTag,{value:"Module"})),$e=()=>{ve();const{selectors:r,actions:e}=xe(),{progressState:t,controls:s}=we(),[n,a]=l.useState(!1),[i,u]=l.useState(""),[c,m]=l.useState(!1),g=d=>{d.preventDefault(),i.trim()&&(e.submitText(i.trim()),u(""))},p=()=>{r.isRecording?e.cancel():e.startCapture()},h=d=>{d.key==="Escape"&&e.cancel()};return r.isVisible?o.jsxs("div",{className:"h-full w-full flex items-center justify-center bg-transparent",children:[o.jsxs("div",{className:"bg-black bg-opacity-80 backdrop-blur-sm rounded-2xl p-6 w-full max-w-lg mx-4 shadow-2xl animate-fade-in",children:[o.jsx(Te,{currentState:r.currentState,showStepBadges:r.showStepBadges}),o.jsx("form",{onSubmit:g,className:"mb-4",children:o.jsxs("div",{className:"flex items-center space-x-3",children:[o.jsx("input",{type:"text",value:i,onChange:d=>u(d.target.value),onKeyDown:h,placeholder:"Type your command or use voice...",disabled:r.isProcessing,className:"flex-1 px-4 py-3 bg-gray-800 text-white rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none disabled:opacity-50"}),o.jsx("button",{type:"button",onClick:p,disabled:!r.canStartVoice&&!r.isRecording,className:`p-3 rounded-lg transition-all duration-200 ${r.isRecording?"bg-red-500 hover:bg-red-600 animate-pulse":r.canStartVoice?"bg-blue-500 hover:bg-blue-600":"bg-gray-500 cursor-not-allowed"} text-white disabled:opacity-50`,children:"🎤"}),o.jsx("button",{type:"button",onClick:()=>a(!0),className:"p-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"⚙️"})]})}),r.isProcessing&&o.jsxs("div",{className:"mb-4 p-3 bg-gray-800 rounded-lg",children:[o.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Status:"}),o.jsxs("div",{className:"text-white",children:[r.currentState==="capture"&&"Listening...",r.currentState==="parseIntent"&&"Understanding your request...",r.currentState==="route"&&"Determining action...",r.currentState==="execute"&&"Executing command...",r.currentState==="verify"&&"Waiting for confirmation...",r.currentState==="respond"&&"Generating response...",r.currentState==="recover"&&"Handling error..."]})]}),r.currentState==="verify"&&r.executionResult&&o.jsxs("div",{className:"mb-4 p-4 bg-yellow-900 bg-opacity-50 rounded-lg border border-yellow-600",children:[o.jsx("div",{className:"text-sm text-yellow-400 mb-2",children:"Confirmation Required:"}),o.jsx("div",{className:"text-white text-sm mb-3",children:r.executionResult.message}),o.jsxs("div",{className:"flex space-x-2",children:[o.jsx("button",{onClick:e.confirmExecution,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm",children:"Confirm"}),o.jsx("button",{onClick:e.cancelExecution,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md text-sm",children:"Cancel"})]})]}),r.error&&o.jsxs("div",{className:"mb-4 p-3 bg-red-900 bg-opacity-50 rounded-lg border border-red-600",children:[o.jsx("div",{className:"text-sm text-red-400 mb-1",children:"Error:"}),o.jsx("div",{className:"text-white text-sm",children:r.error})]}),o.jsx(Ee,{isVisible:t.isActive,progress:t.current,onCancel:t.canCancel?s.cancelProgress:void 0}),(r.input||r.result)&&!t.isActive&&o.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 animate-slide-up",children:[r.input&&o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Input:"}),o.jsx("div",{className:"text-white text-sm",children:r.input})]}),r.intent&&o.jsxs("div",{className:"mb-3",children:[o.jsx("div",{className:"text-sm text-purple-400 mb-1",children:"Intent:"}),o.jsxs("div",{className:"text-white text-sm",children:[r.intent.action," (confidence: ",Math.round(r.intent.confidence*100),"%)"]})]}),r.result&&o.jsxs("div",{children:[o.jsx("div",{className:"text-sm text-green-400 mb-1",children:"Result:"}),o.jsx("div",{className:"text-white text-sm",children:r.result})]}),t.history.length>0&&o.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-600",children:[o.jsxs("button",{onClick:()=>m(!c),className:"text-xs text-gray-400 hover:text-gray-300 transition-colors",children:[c?"Hide":"Show"," Progress History (",t.history.length,")"]}),c&&o.jsxs("div",{className:"mt-2",children:[o.jsx(Re,{progressHistory:t.history,maxItems:5}),o.jsx("button",{onClick:s.clearHistory,className:"text-xs text-red-400 hover:text-red-300 mt-2 transition-colors",children:"Clear History"})]})]})]}),o.jsxs("div",{className:"mt-4 text-xs text-gray-400 text-center",children:["STT: ",r.settings.sttProvider," | NLP: ",r.settings.allowCloudNLP?"Cloud":"Local"," | TTS: ",r.settings.ttsProvider]}),!1]}),o.jsx(Pe,{isOpen:n,onClose:()=>a(!1),settings:r.settings,onSettingsChange:e.updateSettings}),!1]}):null};O.createRoot(document.getElementById("root")).render(o.jsx(W.StrictMode,{children:o.jsx($e,{})}));
